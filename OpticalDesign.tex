\section{Principe}
The principle of the optical design to be realized is schematized on the figure \ref{fig:OpticalPrincipe}.\bigbreak
The output beam of the telescope must be made parallel before the system can be installed. Once the beam is parallel,
a mask composed of 2 equal openings will limit it. This mask correspond to the entry of the system.\newline
The beam will enter to a prism which will deflect the beams to a lens.
The lens will intersept the 2 beams and allow to focus them on a sensor (BW camera).
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.7]{assets/figures/Optical Design/Schéma optique.png}
    \caption{Optical schematic principe}
    \label{fig:OpticalPrincipe}
\end{figure}
\newpage
%====================================================================================================
%====================================================================================================
% Drawing rays with matlab
%====================================================================================================
%====================================================================================================
\section{Drawing rays with matlab}
This part will correspond to the mathematical research to draw the rays on a matlab program. To simplify the program,
the chosen method is to draw lines through 2 points. The calculated points are the following:
\begin{enumerate}
    \item Prism entry = ($X_{PE1,2,3,4},Y_{PE1,2,3,4}$)
    \item Prism exit = ($X_{PO1,2,3,4},Y_{PO1,2,3,4}$)
    \item Lens entry/exit = ($X_{L1,2,3,4},Y_{L1,2,3,4}$)
    \item Screen entry = ($X_{S12,34},Y_{S12,34}$)
\end{enumerate}
Known data :
\begin{itemize}
    \item Prism angle = $\alpha$ [$\deg$] (converted into radian for the equations)
    \item Deflection of the incident beam = $i$ [" arc] (converted into radian for the equations)
    \item focal lens = $F$ [mm]
    \item Hole diameter = $d$ [mm]
    \item Distance betweeen two holes = $e$ [mm]
    \item Distance between the prism and the lens = $E$ [mm]
    \item Refractive index of the prism = $n_p$ [-]
    \item Prism width = $t_c$ [mm]
    \item Prism height = $h$ [mm]
\end{itemize}
Needed data :
\begin{itemize}
    \item Screen height = $H$ [mm]
    \item System length = $L$ [mm]
\end{itemize}
\newpage
%====================================================================================================
% Prism
%====================================================================================================
\subsection{Prsim}
\begin{figure}[H]
    \centering
    \includegraphics[scale=0.8]{assets/figures/Optical Design/Schéma prisme.png}
    \caption{Schematic of drawing rays at the input of the prism}
    \label{fig:Prism_Schematic}
\end{figure}
First, set the X and Y input coordinates.
\begin{equation}
    X_{PE1} = X_{PE2} = X_{PE3} = X_{PE4}
\end{equation}
\begin{equation}
    Y_{PE1} = \frac{e + d}{2} \newline
    Y_{PE2} = \frac{e - d}{2} \newline
    Y_{PE3} = \frac{-e - d}{2} \newline
    Y_{PE4} = \frac{-e + d}{2}
\end{equation}
Using Snell's law and the relationships between the angles, the exit angle can be determined.
\begin{equation}
    r = \arcsin(\frac{\sin(i)}{n_p})
\end{equation}

\begin{equation}
    \beta = \arcsin(n_p*\sin(\alpha-\arcsin(\frac{\sin(i)}{n_p})))-\alpha
\end{equation}
To find the output values, the affine line function (\ref{eq:DoiteAffine}) is used.
This requires knowledge of the slopes and offsets of the straight lines (beam + prism output face).
\begin{equation}
    m_1 = \frac{-1}{\tan(\frac{\pi}{2}-r)}\newline
    m_2 = \frac{-1}{\tan(\alpha)}
\end{equation}
\begin{equation}
    m_3 = \frac{-1}{\tan(\frac{\pi}{2}-r)}\newline
    m_4 = \frac{1}{\tan(\alpha)}
\end{equation}
\begin{equation}
    b_1 = Y_{PE1}-X_{PE1}*m_1\newline
    b_2 = Y_{PE2}-X_{PE2}*m_2\newline
    b_{1s} = \frac{h}{2}-t_e*m_2
\end{equation}
\begin{equation}
    b_3 = Y_{PE3}-X_{PE3}*m_3\newline
    b_4 = Y_{PE4}-X_{PE4}*m_4\newline
    b_{2s} = \frac{-h}{2}-t_e*m_4
\end{equation}
Now that the line parameters are known, the X and Y output points of each beam can be calculated.
\begin{equation}
    X_{PO1} = \frac{b_{1s}-b_1}{m_1-m_2}\newline
    Y_{PO1} = X_{PE1}*m_1+b_{1s}
\end{equation}
\begin{equation}
    X_{PO2} = \frac{b_{1s}-b_2}{m_1-m_2}\newline
    Y_{PO2} = X_{PE2}*m_2+b_{1s}
\end{equation}
\begin{equation}
    X_{PO3} = \frac{b_{2s}-b_1}{m_1-m_2}\newline
    Y_{PO3} = X_{PE1}*m_1+b_{1s}
\end{equation}
\begin{equation}
    X_{PO2} = \frac{b_{1s}-b_2}{m_1-m_2}\newline
    Y_{PO2} = X_{PE2}*m_2+b_{1s}
\end{equation}
Once the X,Y coordinates of the prism's inputs and outputs are known, it's easy to plot them in matlab (Appendix \ref{App:Matlab}).
%====================================================================================================
% Lens
%====================================================================================================
\subsection{Lens}
\begin{figure}[H]
    \centering
    \includegraphics{assets/figures/Optical Design/Schéma sortie prisme.png}
    \caption{Schematic of drawing rays at the output of the prism}
    \label{fig:PrismLens_Schematic}
\end{figure}
First, let's say :
\begin{equation}
    X_L = E
\end{equation}
With the equation of the affine line (\ref{eq:DoiteAffine}),
where "a" can be determined using trigonometry (\ref{eq:Trigo_tan}),
The offset can be determined using the points previously obtained.
\begin{equation}
    a = \frac{-1}{tan(90-\beta)}
\end{equation}
\begin{equation}
    Y_{out} = a*X_{out} + b ==> b = Y_{out} - a*X_{out}
\end{equation}
We can now pose the equation that determines the $Y_L$ coordinate
\begin{equation}
    Y_{L} = a*X_{L} + b
\end{equation}
Once the X,Y coordinates of the lens's inputs are known, and with the prism's output coordinates, it's easy to plot them in matlab (Appendix \ref{App:Matlab}).
\subsection{Screen}
\begin{figure}[H]
    \centering
    \includegraphics{assets/figures/Optical Design/Schéma Lentille.png}
    \caption{Schematic of drawing rays at the output of the lens}
    \label{fig:Lens_Schematic}
\end{figure}
To begin with, the X coordinate can be set as it corresponds to the focal
point of the lens. Note that this equation is only valid if the lens is approximated to a thin lens.
\begin{equation}
    X = E+F
\end{equation}
Then, thanks to trigonometry (\ref{eq:Trigo_tan}), it is easy to find the coordinates Y
\begin{equation}
    Y = \pm F*tan(\beta)
\end{equation}
Once the X,Y coordinates of the screen's inputs are known, and with the lens's output coordinates, it's easy to plot them in matlab (Appendix \ref{App:Matlab}).
%====================================================================================================
%====================================================================================================
% Matrice de conjuguaison avec matlab
%====================================================================================================
%====================================================================================================
\newpage
\section{Conjugation matrix with matlab}
blblalbalblabl
%====================================================================================================
%====================================================================================================
% Camera specifications
%====================================================================================================
%====================================================================================================
\section{Camera specifications}
In order to determine which sensor will have the right specifications for this application,
several elements will need to be calculated :
\begin{itemize}
    \item Pixel size to ensure an image with sufficient information
    \item Screen size
    \item The size the image will occupy on the sensor
\end{itemize}
\bigbreak
To begin with, the mask must be positioned at the telescope entrance. To do this, the relationship between
the holes and their spacing is used (:::). A virtual mask is placed over the telescope entrance,
with a 20mm margin taken on the sides (10mm each). Using these elements, the diameter of the holes on the
telescope can be determined by the equation \ref{eq:DMT} with $D_{MT}$ = diameter of a hole on the telescope entrance,
$D$ = diameter of the telescope, $margin$ = 20mm, $ratio$ = ratio between the holes and their spacing.
\begin{equation}\label{eq:DMT}
    D_{MT} = \frac{(D-margin)}{(ratio + 1)} = \frac{(305-20)}{5+1} = 47.5 mm
\end{equation}
Now we need to know the transverse magnification ($G_t$) between the holes in the mask and the virtual holes in the telescope.
This magnification will later be used to determine the available FOV.
\begin{equation}
    G_t = \frac{D_{holes}}{D_{MT}} = \frac{1}{47.5} = 0.0211
\end{equation}
\textbf{\textcolor{red}{Truc du sigma}}
\newline
Once the $\sigma_T$ is known, the fov as seen through the telescope can be determined. In equation \ref{eq:FOV_T}, $D_S$ is the diameter
of the sunspots to be measured (20").
\begin{equation}\label{eq:FOV_T}
    FOV_T = 6 * \sigma_T + D_S
\end{equation}
Once the FOV seen by the telescope is known, this parameter must be transferred to the mask.
\begin{equation}
    FOV_M = FOV_T * G_t^{-1}
\end{equation}
This FOV will be converted into a radiant and can then be transferred to the CMOS sensor
using the lens focal length ($F$) determined in section \ref{sec:Opti_Lens}.
\begin{equation}
    FOV_S = FOV_M * F
\end{equation}
Finally, the three elements listed at the beginning of this section can be calculated.
\begin{itemize}
    \item ballbalblalblalba
          \begin{equation}
              pixel_{max} = \frac{\lambda*F}{2*D_{holes}}
          \end{equation}
    \item blablalballbaa
\end{itemize}

%====================================================================================================
%====================================================================================================
% Lens selection
%====================================================================================================
%====================================================================================================
\section{Lens selection}\label{sec:Opti_Lens}
balblalbalblalab
%====================================================================================================
%====================================================================================================
% Prism selection
%====================================================================================================
%====================================================================================================
\section{Prism selection}
blalbalblalb
%====================================================================================================
%====================================================================================================
% Limitation
%====================================================================================================
%====================================================================================================
\section{Limitations of the system}\label{sec:Opti_Limit}
Parler du ratio du masque etc
Parler du filtre solaire pour le télescope